---
layout: post
title: "nfs"
date: 2020-06-15
excerpt: "nfs"
tags: [nfs]
config: true
comments: false
---

# zfs


## インストール

```console
$ sudot apt install nfs-kernel-server
```

## /etc/excerpt

公開したいディレクトリ or ディスクをシェアする設定

```console
/home/gimpei/sda        *(rw,async,no_subtree_check)
/home/gimpei/sdb        *(rw,async,no_subtree_check)
/home/gimpei/sdc        *(rw,async,no_subtree_check)
/home/gimpei/sdd        *(rw,async,no_subtree_check)
/home/gimpei/sde        *(rw,async,no_subtree_check)
/home/gimpei/sdf        *(rw,async,no_subtree_check)
/home/gimpei/nvme1n1    *(rw,async,no_subtree_check)
/home/gimpei/.mnt/ramdisk       *(rw,async,no_subtree_check,fsid=1)
```

**反映**  
```console
$ sudo exportfs -a
```

## /etc/fstab

rsize,wsizeは読み書きのバイト数、大きいほうが基本的に良い  
syncよりasycn  
fscはfs-cacheを有効化したときにつけるオプション  

```
[fd00::16]:/home/gimpei/sdb /home/gimpei/.mnt/favs00 nfs rsize=81920,wsize=81920,async,fsc  0 0
[fd00::20]:/home/gimpei/nvme0n1 /home/gimpei/.mnt/favs01 nfs rsize=81920,wsize=81920,async,fsc 0 0
[fd00::12]:/home/gimpei/sda /home/gimpei/.mnt/favs02 nfs rsize=81920,wsize=81920,async,fsc 0 0
[fd00::12]:/home/gimpei/sdd /home/gimpei/.mnt/favs03 nfs rsize=81920,wsize=81920,async,fsc 0 0
[fd00::12]:/home/gimpei/sdc /home/gimpei/.mnt/favs04 nfs rsize=81920,wsize=81920,async,fsc 0 0
[fd00::16]:/home/gimpei/nvme0n1 /home/gimpei/.mnt/favs05 nfs rsize=81920,wsize=81920,async,fsc 0 0
[fd00::12]:/home/gimpei/sde /home/gimpei/.mnt/favs06 nfs rsize=81902,wsize=81920,async,fsc 0 0
192.168.50.12:/home/gimpei/sdf /home/gimpei/.mnt/favs07 nfs rsize=81920,wsize=81920,async,fsc 0 0
# cache
[fd00::16]:/home/gimpei/sdc /home/gimpei/.mnt/cache nfs rsize=81920,wsize=81920,async,fsc 0 0
```

## fs-cacheの有効化
キャッシュを利用したほうが基本的に早くなるので入れたほうが良い

```console
$ sudo apt install cachefilesd
```

**/etc/default/cachefilesdの編集**

```console
RUN=yes
```

**cachefilesdの起動**

```console
$ sudo systemctl start cachefilesd
```

## 参考
 - https://blog.frehi.be/2019/01/03/fs-cache-for-nfs-clients/
 - https://www.phoronix.com/scan.php?page=news_item&px=Linux-5.6-NFS-Client
 
