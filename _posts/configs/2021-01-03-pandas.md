---
layout: post
title:  "pandas"
date:   2021-01-03
excerpt: "pandasのチートシート"
project: false
config: true
tag: ["python", "pandas"]
comments: false
---

# pandasのチートシート
 - IFがどんどん新しくなっている
 - 新規機能の追加やシンタックスが覚えるのが難しい
 - よく使う機能を記しておく

## 前提: 説明に使うデータセット
 - [World Health 2020 🌏 | For Geospatial Analysis](https://www.kaggle.com/utkarshxy/who-worldhealth-statistics-2020-complete)

*download*
```console
$ kaggle datasets download utkarshxy/who-worldhealth-statistics-2020-complete
```

## pivot
 - 特定のrowをcolumnにする
 - `index`, `columns`, `values`を指定する

e.g. 全世界の年ごとのドクターの数

```python
>>> import pandas as pd
>>> df = pd.read_csv("medicalDoctors.csv")
>>> df
         Location  Period                     Indicator  First Tooltip
0     Afghanistan    2016  Medical doctors (per 10,000)           2.78
...           ...     ...                           ...            ...
2505     Zimbabwe    1990  Medical doctors (per 10,000)           1.27

[2506 rows x 4 columns]
>>> df.pivot(index=["Location"], columns=["Period"], values=["First Tooltip"])
                                   First Tooltip                                                                      ...
Period                                      1990   1991   1992   1993   1994   1995   1996   1997   1998 1999   2000  ...  2008   2009   2010   2011   2012   2013  2014   2015   2016   2017   2018
Location                                                                                                              ...
...                                          ...    ...    ...    ...    ...    ...    ...    ...    ...  ...    ...  ...   ...    ...    ...    ...    ...    ...   ...    ...    ...    ...    ...
Zimbabwe                                    1.27    NaN    NaN    NaN    NaN   1.43    NaN    NaN    NaN  NaN   1.26  ...  0.60   1.21   1.27   0.82   0.81   0.83  1.24   1.82   1.79   1.86   2.10

[194 rows x 29 columns]
>>>
```

## pd.get_dummmies
 - ダミー変数を入れる
 - カテゴリカル変数をワンホットベクトルに変える

```python
>>> pd.get_dummies(df, columns=["Location"])
      Period                     Indicator  First Tooltip  Location_Afghanistan  ...  Location_Viet Nam  Location_Yemen  Location_Zambia  Location_Zimbabwe
0       2016  Medical doctors (per 10,000)           2.78                     1  ...                  0               0                0                  0
...      ...                           ...            ...                   ...  ...                ...             ...              ...                ...
2505    1990  Medical doctors (per 10,000)           1.27                     0  ...                  0               0                0                  1

[2506 rows x 197 columns]
```

## dataframeのプロパティに代入
```python
>>> df.Period = df.Period + 1
```

## 尖度・歪度・std

```python
agg_df = df.groupby(["foo", "bar", ...]) \
			.agg(
			   mean=(target, "mean"), 
			   median=(target, "median"), 
			   skew=(target, "skew"),
			   kurtosis=(target, pd.DataFrame.kurt),
			   std=(target, "std"))
```

## 特定のindexの値をupdate
 - e.g. 特定の値が一定以下の検索を行いindexの値を取り出し、値を3倍にする

```python
index = df[df["First Tooltip"] <= 100].index

df.loc[index, "Period"] = df.loc[index, "Period"] * 3
```

## dataframeに対するapply

`apply`に対する`axis=1`を適応すると`行`に対して適応できる
```python
df.apply(something_function, axis=1)
```
