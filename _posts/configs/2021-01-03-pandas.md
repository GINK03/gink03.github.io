---
layout: post
title:  "pandas"
date:   2021-01-03
excerpt: "pandas"
project: false
config: true
tag: ["python", "pandas"]
comments: false
---

# pandas
 - IFがどんどん新しくなっている
 - 新規機能の追加やシンタックスが覚えるのが難しい
 - よく使う機能を記しておく

## 前提: 説明に使うデータセット
 - [World Health 2020 🌏 | For Geospatial Analysis](https://www.kaggle.com/utkarshxy/who-worldhealth-statistics-2020-complete)

*download*
```console
$ kaggle datasets download utkarshxy/who-worldhealth-statistics-2020-complete
```

## pivot
 - 特定のrowをcolumnにする
 - `index`, `columns`, `values`を指定する

e.g. 全世界の年ごとのドクターの数

```python
>>> import pandas as pd
>>> df = pd.read_csv("medicalDoctors.csv")
>>> df
         Location  Period                     Indicator  First Tooltip
0     Afghanistan    2016  Medical doctors (per 10,000)           2.78
1     Afghanistan    2015  Medical doctors (per 10,000)           2.85
2     Afghanistan    2014  Medical doctors (per 10,000)           2.98
3     Afghanistan    2013  Medical doctors (per 10,000)           2.85
4     Afghanistan    2012  Medical doctors (per 10,000)           2.41
...           ...     ...                           ...            ...
2501     Zimbabwe    2005  Medical doctors (per 10,000)           1.26
2502     Zimbabwe    2004  Medical doctors (per 10,000)           1.74
2503     Zimbabwe    2000  Medical doctors (per 10,000)           1.26
2504     Zimbabwe    1995  Medical doctors (per 10,000)           1.43
2505     Zimbabwe    1990  Medical doctors (per 10,000)           1.27

[2506 rows x 4 columns]
>>> df.pivot(index=["Location"], columns=["Period"], values=["First Tooltip"])
                                   First Tooltip                                                                      ...
Period                                      1990   1991   1992   1993   1994   1995   1996   1997   1998 1999   2000  ...  2008   2009   2010   2011   2012   2013  2014   2015   2016   2017   2018
Location                                                                                                              ...
Afghanistan                                  NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN  NaN    NaN  ...  1.74   2.13   2.37   2.52   2.41   2.85  2.98   2.85   2.78    NaN    NaN
Albania                                    13.74  14.61  16.22  14.13  13.45  13.63  13.81  13.89  13.90  NaN  13.82  ...   NaN  12.30  12.35  12.22  12.68  12.77   NaN    NaN  12.16    NaN    NaN
Algeria                                      NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN  NaN    NaN  ...   NaN    NaN    NaN    NaN    NaN    NaN   NaN    NaN  18.33  17.88  17.19
Andorra                                      NaN    NaN    NaN    NaN    NaN  22.38    NaN  24.57  25.27  NaN  25.69  ...   NaN  31.48    NaN    NaN    NaN    NaN   NaN  33.33    NaN    NaN    NaN
Angola                                       NaN    NaN    NaN    NaN    NaN    NaN    NaN   0.59    NaN  NaN    NaN  ...   NaN   1.31    NaN    NaN    NaN    NaN   NaN    NaN    NaN   2.15    NaN
...                                          ...    ...    ...    ...    ...    ...    ...    ...    ...  ...    ...  ...   ...    ...    ...    ...    ...    ...   ...    ...    ...    ...    ...
Venezuela (Bolivarian Republic of)           NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN  NaN    NaN  ...   NaN    NaN    NaN    NaN    NaN    NaN   NaN    NaN    NaN    NaN    NaN
Viet Nam                                     NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN  NaN    NaN  ...  6.65   6.98   7.10    NaN   8.21    NaN  7.83   7.96   8.28    NaN    NaN
Yemen                                        NaN    NaN    NaN    NaN    NaN    NaN    NaN   2.39    NaN  NaN    NaN  ...  3.16   3.17    NaN    NaN    NaN    NaN  5.25    NaN    NaN    NaN    NaN
Zambia                                       NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN    NaN  NaN    NaN  ...  0.62   0.61   0.61   1.65   1.66    NaN   NaN    NaN   1.63    NaN  11.87
Zimbabwe                                    1.27    NaN    NaN    NaN    NaN   1.43    NaN    NaN    NaN  NaN   1.26  ...  0.60   1.21   1.27   0.82   0.81   0.83  1.24   1.82   1.79   1.86   2.10

[194 rows x 29 columns]
>>>
```

## pd.get_dummmies
 - ダミー変数を入れる
 - カテゴリカル変数をワンホットベクトルに変える

```python
>>> pd.get_dummies(df, columns=["Location"])
      Period                     Indicator  First Tooltip  Location_Afghanistan  ...  Location_Viet Nam  Location_Yemen  Location_Zambia  Location_Zimbabwe
0       2016  Medical doctors (per 10,000)           2.78                     1  ...                  0               0                0                  0
1       2015  Medical doctors (per 10,000)           2.85                     1  ...                  0               0                0                  0
2       2014  Medical doctors (per 10,000)           2.98                     1  ...                  0               0                0                  0
3       2013  Medical doctors (per 10,000)           2.85                     1  ...                  0               0                0                  0
4       2012  Medical doctors (per 10,000)           2.41                     1  ...                  0               0                0                  0
...      ...                           ...            ...                   ...  ...                ...             ...              ...                ...
2501    2005  Medical doctors (per 10,000)           1.26                     0  ...                  0               0                0                  1
2502    2004  Medical doctors (per 10,000)           1.74                     0  ...                  0               0                0                  1
2503    2000  Medical doctors (per 10,000)           1.26                     0  ...                  0               0                0                  1
2504    1995  Medical doctors (per 10,000)           1.43                     0  ...                  0               0                0                  1
2505    1990  Medical doctors (per 10,000)           1.27                     0  ...                  0               0                0                  1

[2506 rows x 197 columns]
```

## dataframeのプロパティに代入
 - できることを知らなかった

```python
>>> df.Period = df.Period + 1
```

## 尖度・歪度・std

```python
agg_df = df.groupby(["foo", "bar", ...]) \
			.agg(
			   mean=(target, "mean"), 
			   median=(target, "median"), 
			   skew=(target, "skew"),
			   kurtosis=(target, pd.DataFrame.kurt),
			   std=(target, "std"))
```
