---
layout: post
title: "gcloud"
date: 2021-03-06
excerpt: "gcloudについて"
tags: ["gcp", "gcloud"]
config: true
comments: false
---

# gcloudについて

## インストール

***ubuntu***  
```console
$ sudo snap install google-cloud-sdk --classic
```

***osx***  
```console
$ brew install google-cloud-sdk
```
 - zshのオートコンプリートがバグることがあるのでその場合はシステム的に変更された`.zshrc`を戻す
 - caskでインストールされるとPATHが設定されないので、PATHを追加する
   - PATH; `/usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/bin`


`PATH`が特殊なので注意  
```console
$(brew --prefix)/Caskroom/google-cloud-sdk/latest/google-cloud-sdk
```

## 現在の設定を確認する

```console
$ gcloud info
```

## 複数の設定を使い分ける

### 設定を作成する

```console
$ gcloud config configurations create <config-name>
```

### 設定を有効化する

```console
$ gcloud config configurations activate <config-name>
```

## プロジェクトのセット

```console
$ gcloud config set project PROJECT_NAME
```

## アカウントのセットアップ

```console
$ gcloud init --skip-diagnostics
```

## 現在設定しているアカウントを切り替える
 1. `gcloud init`
 2. `[3] Switch to and re-initialize existing configuration: [default]`を選択
 3. 切り替え先のアカウントを選択
 4. 切り替え先のプロジェクトを選択

## iam-policyの確認

```console
$ gcloud projects get-iam-policy <project-name>
bindings:
- members:
  - serviceAccount:service-*******@compute-system.iam.gserviceaccount.com
  role: roles/compute.serviceAgent
- members:
  - serviceAccount:service-*******@containerregistry.iam.gserviceaccount.com
  role: roles/containerregistry.ServiceAgent
  ...
```

## apiとの関係

`gcloud`コマンドは`API`をコマンドでラップしたものであるが、python等のスクリプトから呼び出す際は`google-api-python-client`を用いる  
仕様が複雑で[ドキュメント](https://googleapis.github.io/google-api-python-client/docs/)を精読しないと使うことが難しい  


