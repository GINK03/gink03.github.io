---
layout: post
title: "nextdns, adguard"
date: 2021-02-08
excerpt: "nextdns, adguardの使い方とペアレンタルコントロール"
tags: ["ペアレンタルコントロール", "nextdns", "adguard", "adblocking"]
config: true
comments: false
---

# nextdns, adguardの使い方とペアレンタルコントロール

 - DNSサーバ
   - 公開されているDNSサーバを利用する方法
   - 自分でDNSサーバをセットアップする方法
 - 広告とフィッシング詐欺とアダルトサイトをフィルタリングできる
 - iPhoneはセルラー通信ではDNSを書き換えることができないのでVPNソフトを使用する必要がある
 - より詳細にコントロールしたい場合、クラウドDNSサービスの[NextDNS](https://my.nextdns.io/d435da/setup)などがよい

# 公開されているDNSサーバを利用する方法
[公式サイト](https://kb.adguard.com/en/dns/setup-guide)にIPアドレスが記されている  

例えば、`94.140.14.15`のfamily protectionのDNSサーバを指定して`pornhub.com`を引くと、代わりにペアレントコントロールのIPになっていることがわかる  

```console
$ dig @94.140.14.15 pornhub.com

; <<>> DiG 9.16.1-Ubuntu <<>> @94.140.14.15 pornhub.com
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 50237
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: d9c3274f83062c45 (echoed)
;; QUESTION SECTION:
;pornhub.com.                   IN      A

;; ANSWER SECTION:
pornhub.com.            3600    IN      A       94.140.14.35

;; Query time: 4 msec
;; SERVER: 94.140.14.15#53(94.140.14.15)
;; WHEN: 月  2月 08 20:05:13 JST 2021
;; MSG SIZE  rcvd: 68
```

<style>
.responsive-wrap iframe{ max-width: 100%;}
</style>
<div class="responsive-wrap">
<!-- this is the embed code provided by Google -->
  <iframe src="https://docs.google.com/presentation/d/e/2PACX-1vSRq4oG8nrwmTHdt2oi5xldUKFTx-4Iy49wOkfcZUIzf4gbwxbPo3s0N9ZiK24PCxEZwzvnEpIzR35C/embed" frameborder="0" width="960" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
<!-- Google embed ends -->
</div>

# 自分でDNSサーバをセットアップする方法
## ubuntu linuxでの利用
 - https://www.330k.info/essay/ubuntu-softether-adguardhome-dns-setting/

### 公式wiki
 - https://github.com/AdguardTeam/AdGuardHome/wiki/Getting-Started#running-without-superuser

### systemdに登録する

```console
$ sudo ./AdGuardHome -s install
```

## mac osxでの仕様
 - github releasesからダウンロードする
   - https://github.com/AdguardTeam/AdGuardHome/releases

```console
$ unzip AdGuardHome_darwin_amd64.zip
$ cd AdGuardHome
$ sudo ./AdGuardHome -s install
```
これでdnsサーバがインストールされる  

`http://127.0.0.1:3000`で初期セットアップを完了して完了  

セットアップ完了後`http://127.0.0.1`でコントロールパネルにアクセス可能  

## 再起動
長期間起動していると不安点になることがある  

```console
$ sudo ./AdGuardHome -s restart
```

## アクセスログについて
 - どのDNSにリクエストを送ったかがわかる
 - `AdGuardHome`のバイナリのある場所にログが保存されている
