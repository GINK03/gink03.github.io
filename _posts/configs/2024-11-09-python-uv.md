---
layout: post
title: "python uv"
date: 2024-11-09
excerpt: "pythonのuvの使い方"
config: true
tag: ["python", "uv", "rye", "poetry"]
comments: false
sort_key: "2023-06-03"
update_dates: ["2023-06-03"]
---

# pythonのuvの使い方

## 概要
 - pythonのuvは高速なパッケージ管理ツールで、依存解決エンジンもRust製
 - 実行時はPEP 723に対応しており、pythonファイル中のメタデータを参照して依存を解決する

## ryeとの差分
 - ほぼ同じ機能(add, syncなど)を持つ
 - プロジェクト初期化時に`src/project-name`というディレクトリ構造は作成されない
 - `requirements.lock`のファイルは作成されないが、`pyproject.toml`と`uv.lock`が作成されるのでそのままパッケージとして使用可能

## インストール

**macOS/Linux**
```console
$ curl -LsSf https://astral.sh/uv/install.sh | sh
```

**アップデート**
```console
$ uv self update
```

## pythonとパッケージの管理

**任意のバージョンのpythonをインストール**
```console
$ uv python install 3.10 3.11 3.12 3.13
```

**使用可能なpythonバージョンの確認**
```console
$ uv python list
```

**`.python-version`ファイルにバージョンを指定**
```console
$ uv python pin 3.13
```

**パッケージの追加**
```console
$ uv add <package-name>
```

**インストールされたパッケージの更新**
```console
$ uv sync --upgrade
```

**パッケージのビルド**
```console
$ uv build
```

## 実行

**pythonスクリプトの実行**
```console
$ uv run main.py
```

**リモートのpythonスクリプトの実行**
```console
$ uv run https://example.com/script.py
```
 - gistのURLも指定可能

## pyproject.tomlの例
 - `project.scripts`にコマンドラインツールを登録可能

```toml
[project]
name = "your-project-name"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = [
  ...
]

[project.scripts]
screenshot = "utils.screenshot:main"
googlesearch = "utils.googlesearch:main"

[tool.uv]
```

**コマンドラインツールの実行**
```console
$ uv run screenshot
```

## dockerの設定
 - [Using uv in Docker](https://docs.astral.sh/uv/guides/integration/docker/)

### Dockerfileの例

```dockerfile
FROM python:3.13-slim

# uv の公式 distroless イメージからバイナリをコピー
# Lambda ベースイメージには pip が含まれないため、マルチステージコピーでインストールする
# https://docs.astral.sh/uv/guides/integration/docker/#installing-uv
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

COPY pyproject.toml uv.lock ./
COPY src/ ./src/

RUN uv pip install --system --no-cache .

CMD sh -c "uv run main.py"
```

## 参考
 - [uv - github](https://github.com/astral-sh/uv)
 - [uv （pythonパッケージマネージャー）の使い方　詳細版](https://zenn.dev/tabayashi/articles/52389e0d6c353a)
