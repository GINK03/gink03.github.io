---
layout: post
title: "mtr"
date: "2021-12-12"
excerpt: "mtrコマンドの使い方"
project: false
config: true
tag: ["linux", "osx", "network", "mtr"]
comments: false
---

# mtrコマンドの使い方

## 概要
 - a network diagnostic tool
 - `traceroute`と`ping`を組み合わせたようなツール
 - 経路毎のパケットロスを観察できるのでケーブル不良、ルータの不良、プロバイダの問題などを切り分けしやすい


## インストール

**ubuntu, debian**
```console
$ apt install mtr
```

**osx**
```console
$ brew install mtr
$ brew info mtr
mtr: stable 0.94 (bottled), HEAD
'traceroute' and 'ping' in a single tool
https://www.bitwizard.nl/mtr/
/usr/local/Cellar/mtr/0.94 (12 files, 255.4KB) * # 実行できるバイナリは/usr/local/sbinにある
```

## 引数
 - `-c <count>`
   - count回実行する
 - `-u|--udp`
   - udpで実行
 - `-T|--tcp`
   - tcpで実行
 - `--report`
   - 最終結果をレポート形式で出力
   - 終了後にmtrの出力が消えない

## 具体例

#### 家のコンピュータにマクドナルドの無料wifiでUDPでどの程度のパフォーマンスなのか

```console
$ sudo mtr -T gimpeik.duckdns.org -c 10
```

<div>
  <img src="https://user-images.githubusercontent.com/4949982/145698093-c3a6273d-990a-43c9-93e8-6abbdf5f6c65.png">
</div>

最初のルータまでで10%程度のパケットロスがあることがわかる

#### 家のコンピュータに栃木県の実家からUDPでどの程度のパフォーマンスなのか


```console
$ sudo mtr -T gimpeik.duckdns.org -c 60 --report
Start: 2022-01-22T16:09:56+0900
HOST: O-15185-MAC                 Loss%   Snt   Last   Avg  Best  Wrst StDev
  1.|-- 192.168.3.1                1.7%    60    2.7   3.4   1.7  12.9   2.5
  2.|-- tochigi10-z02.flets.2iij.  1.7%    60   16.5 143.9   6.6 1034. 323.6
  3.|-- tochigi10-ntteast0.flets.  1.7%    60   16.5 127.3   6.9 1033. 301.5
  4.|-- tky001lip32.iij.net        1.7%    60   19.1 147.8   9.2 1033. 321.5
  5.|-- tky001bb00.iij.net         1.7%    60   22.1 165.8   9.8 1035. 340.8
  6.|-- tky001bb01.iij.net         5.0%    60   22.0 171.5   9.4 1035. 345.3
        tky001bb01.iij.net
  7.|-- tky001lip31.iij.net        3.3%    60   21.8 165.8   9.3 1032. 343.7
  8.|-- tokyo10-ntteast1.flets.2i 10.0%    60   21.1 159.5   9.5 1032. 333.4
  9.|-- tokyo10-n405.flets.2iij.n  5.0%    60   20.9 152.1   9.7 1031. 325.9
 10.|-- 125.12.100.220.dy.bbexcit  1.7%    60   22.0 184.9  11.7 1051. 358.6
```
