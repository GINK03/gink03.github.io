---
layout: post
title: "zsh"
date: 2021-02-06
excerpt: "zsh の tips"
config: true
tag: ["zsh", "shell"]
sort_key: "2022-05-23"
update_dates: ["2022-05-23","2022-02-01","2022-01-23","2022-01-21","2022-01-18","2021-12-27","2021-12-24","2021-11-25","2021-11-25","2021-08-31","2021-04-20","2021-02-24","2021-02-16","2021-02-16","2021-02-06"]
comments: false
---

# zsh の tips

## インストール

**macOS**
```console
$ brew install zsh
```

## デフォルトの shell を zsh にする

```console
$ chsh -s $(which zsh)
```
 - root ユーザでこの変更を行うのは root でログインできなくなる可能性がありリスクがある


## プラグインで機能を拡張する
 - 詳細は [/zsh-antigen/](/zsh-antigen/)


## キーバインド
 - 詳細は [/zsh-keybind/](/zsh-keybind/)

## zsh の構文と具体例
 - 詳細は [/zsh-syntax/](/zsh-syntax/)

## トラブルシューティング

#### 環境変数を適切に設定しているのに、`ls`コマンド等で文字化けが起きるとき
 - 原因
   - 何らかの影響で`locales`パッケージが不整合を起こしていることがあった  
 - 対応
   - 以下のコマンドで`ja_JP.UTF-8`に設定し直すことで治った事があった  

```console
$ sudo dpkg-reconfigure locales
```

#### 終端文字`%`が正しくハンドルされなくて描画がずれる時
 - 原因
   - zsh の機能の1つで終端文字を stdin がキャッチできないとき `%` で代替する機能がありハンドルにミスると terminal が崩壊する
 - 対応
   - `reset`を入力する

```console
$ reset
```
 - [参考](https://unix.stackexchange.com/questions/61584/how-to-solve-the-issue-that-a-terminal-screen-is-messed-up-usually-after-a-res)


#### `ctrl+a`, `ctrl+e`でzshで移動できない(^A, ^Eが入力されてしまう)
 - 原因
   - `ctrl+a`, `ctrl+e`がハンドルされていない
 - 対応
   - `.zshrc` と `.tmux.conf` で Emacs スタイルを適用すると入力できる  

**.zshrc**  
```shell
bindkey -e
```

**.tmux.conf**  
```shell
set -g mode-keys emacs
set -g status-keys emacs
```
 - [参考](https://askubuntu.com/questions/1155199/ctrl-a-and-ctrl-e-map-incorrectly-in-tmux)

#### sudoしたときユーザ定義のaliasを引き継ぐ

```shell
alias sudo="sudo "
```
 - [参考](https://linuxhandbook.com/run-alias-as-sudo/)

#### `zsh compinit: insecure directories...`と警告がでる
 - 原因
   - zsh のモジュールがセキュアな設定になっていないことが原因  
   - Homebrew の zsh 補完などが原因で出ることがある  
 - 対応
   - compaudit で出力される内容をユーザ only のパーミッションにすることで修正できる  

```console
$ compaudit | xargs chmod g-w
```
 - [参考](https://stackoverflow.com/questions/13762280/zsh-compinit-insecure-directories)
