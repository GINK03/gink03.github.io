---
layout: post
title: "bit dp"
date: 2021-05-21
excerpt: "bit dpについて"
computer_science: true
hide_from_post: true
tag: ["algorithm", "math", "bit dp"]
comments: false
---

# bit dp
 - 要素をbitのフラグとしてみなしその構成パターンのdpテーブルを作って管理する
   - 巡回セールスマン問題
 - `配るdp`と`貰うdp`の２種類が存在し、問題によってはどちらでも行けることがある
 
## 例; 配るdpと貰うdp両方どちらでもOKなケース
**問題**  
 - [AtCoder Beginner Contest 041; D - 徒競走](https://atcoder.jp/contests/abc041/tasks/abc041_d)
**解説**  
 - 貰うもの、配るものをbit maskとして管理する
 - 前の状態、次の状態を決定するのもbit maskを利用する

**解答(配るdp)**  

```python
N,M=map(int,input().split())

dp=[0]*(1<<N)
dp[0]=1

edge = [0]*N
for _ in range(M):
    x,y=map(int,input().split())
    "xはyより早くにゴールしたという情報をyを起点に記録"
    edge[y-1] |= 1<<(x-1)

for s in range(1<<N):
    for j in range(N):
        "sとjが共起してなかったら"
        if s & (1<<j) == 0:
            "かつ、sと配る先が共起していなかったら"
            if s&edge[j] == 0:
                dp[s|(1<<j)] += dp[s]; "配る"

print(dp[-1])
```

**解答(貰うdp)**  

```python
N,M=map(int,input().split())

dp=[0]*(1<<N); "ありえるパターンの大きさのリスト"
dp[0]=1

"もらうためのビットの対応を作る"
edge = [0]*N
for _ in range(M):
    x,y=map(int,input().split())
    edge[x-1] |= 1<<(y-1); "xはyより早くにゴールしたというbitパターンを記録"

for s in range(1<<N):
    for j in range(N):
        "sとjが共起したら"
        if s & (1<<j) > 0:
            "前に早くにゴールしたというパターンを持っていなければ"
            if s&edge[j] == 0:
                dp[s] += dp[s^(1<<j)]; "jがゴールしていない状態のbitパターンを貰う"
print(dp[-1])
```

## 例; スケジュール問題の数え上げ
**問題**  
 - [第１３回日本情報オリンピック 予選（過去問）; D - 部活のスケジュール表 (Schedule)](https://atcoder.jp/contests/joi2014yo/tasks/joi2014yo_d)   

**解説**  
 - ユーザをbitとして考える
 - ビットのパターンはたかだか8つなので数え上げができる
 - 条件を満たすものをカウントするだけ

**解答(想定解法)**  
```python
N=int(input())
S=input()
MOD = 10007
map = {'J':0, 'O': 1, 'I': 2}
P = 1<<3
dp = [0]*P
dp[1] = 1

for s in S:
    now = map[s]
    ndp = [0]*P
    for i in range(P):
        if i&(1<<now) == 0:
            continue
        for j in range(P):
            if i&j == 0:
                continue
            ndp[i] += dp[j]
            ndp[i] %= MOD
    dp = ndp
print(sum(dp)%MOD)
```

**解答(貰うdp)**  
```python
N=int(input())
S=input()
MOD=10007
dp = [[0]*(1<<3) for _ in range(N+1)]
dp[0][1] = 1; "この初期値は謎"

for day, s in enumerate(S):
    must_have = dict(J=0,O=1,I=2)[s]
    for i in range(1<<3):
        if i&(1<<must_have) > 0:
            for j in range(1<<3):
                if i&j > 0:
                    "貰うdp"
                    dp[day+1][i] += dp[day][j]
                    dp[day+1][i] %= MOD
print(sum(dp[-1])%MOD)
```
