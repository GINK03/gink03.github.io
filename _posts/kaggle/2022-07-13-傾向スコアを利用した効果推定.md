---
layout: post
title: "傾向スコアを利用した効果推定"
date: 2022-07-13
excerpt: "傾向スコアを利用した効果推定について"
kaggle: true
tag: ["機械学習", "因果推論", "傾向スコア"]
sort_key: "2022-07-13"
update_dates: ["2022-07-13"]
comments: false
---

# 傾向スコアを利用した効果推定について

## 概要
 - 因果推論を行う際に、セレクションバイアスがあることを解決するアプローチ
 - 代表的な手法
   - 傾向スコアを用いた逆確率重み付け法
     - カテゴリに所属する確率をMLで求めることで、バイアスを解除する方法
   - 傾向スコアマッチング
     - カテゴリに所属する確率が近い or 特徴が近い者同士を比較し、効果量を測定する

## 傾向スコアを用いた逆確率重み付け法(IPW)

### 定式化
 - \\(Z\\); 介入を受けた場合`1`, 受けなかった場合`0`
 - \\(P\\); 介入を受ける確率(を推論)
 - \\(Y\\); 結果
 - \\(X\\); 介入を受けることを説明する特徴量

$$
\bar{Y}_{z=1} = \frac{ \sum_{i=1}^{N} \frac{Z_iY_i}{\hat{P(X_i)}} } { \sum_{i=1}^{N} \frac{Z_i}{\hat{P(X_i)}}}
$$         
 - \\(Y_0\\)の影響量を見積もる
 
$$
\bar{Y}_{z=0} = \frac{ \sum_{i=1}^{N} \frac{(1-Z_i)Y_i}{1-\hat{P(X_i)}} } { \sum_{i=1}^{N} \frac{(1-Z_i)}{1-\hat{P(X_i)}}}
$$
 - \\(Y_1\\)の影響量を見積もる

推定効果量
$$
ATE = \hat{t} = \bar{Y}_{z=1} - \bar{Y}_{z=0} 
$$

### 具体的なユースケース
 - ビールを販売している会社があり、CMの効果を推定したい
 - 路上で、粗品を配り、路上アンケートを求めた
   - アンケートの結果で効果量を見積もれるが、`粗品に反応してアンケートを答える`人のバイアスが入ってしまう
   - このバイアスを解除するために、`粗品に反応してアンケートに答える確率`を計算するモデルを作成し、バイアスを解除する

## 傾向スコアマッチング
 - 似たサンプル同士を紐付けてその平均を取る
 - 意外と安定している方法らしい

---

## 参考
 - [効果検証入門〜正しい比較のための因果推論／計量経済学の基礎](https://www.amazon.co.jp/dp/B0834JN23Y/)
 - [傾向スコアを利用した施策効果推定/Qiita](https://qiita.com/0NE_shoT_/items/286a99d66cf6d3aaccf0)