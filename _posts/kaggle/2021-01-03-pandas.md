---
layout: post
title: "pandas"
date: 2021-01-03
excerpt: "pandasã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ"
project: false
kaggle: true
hide_from_post: true
tag: ["python", "pandas"]
comments: false
---

# pandasã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ
 - IFãŒã©ã‚“ã©ã‚“æ–°ã—ããªã£ã¦ã„ã‚‹
 - æ–°è¦æ©Ÿèƒ½ã®è¿½åŠ ã‚„ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãŒè¦šãˆã‚‹ã®ãŒé›£ã—ã„
 - ã‚ˆãä½¿ã†æ©Ÿèƒ½ã‚’è¨˜ã—ã¦ãŠã

## å‰æ: èª¬æ˜ã«ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
 - [World Health 2020 ğŸŒ | For Geospatial Analysis](https://www.kaggle.com/utkarshxy/who-worldhealth-statistics-2020-complete)

*download*
```console
$ kaggle datasets download utkarshxy/who-worldhealth-statistics-2020-complete
```

## read_csv
 - `error_bad_lines`
   - ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
 - `usecols`
   - ä½¿ç”¨ã™ã‚‹colã‚’æŒ‡å®šã™ã‚‹
   - ç„¡é§„ãªcolã‚’èª­ã¿è¾¼ã¾ãªã„ã®ã§é«˜é€ŸåŒ–ã™ã‚‹
 - `parse error`ãŒç™ºç”Ÿã™ã‚‹ã¨ã
   - `lineterminator='\n'`ã‚’è¿½åŠ ã™ã‚‹

## %pip install 
 - `%`ã¯æ˜ç¢ºã«jupyterã‚’å‹•ã‹ã—ã¦ã„ã‚‹pythonã«å¯¾ã—ã¦ä½œç”¨ã™ã‚‹
 - `!`ã¯pathã«è¨­å®šã•ã‚ŒãŸpythonã«å¯¾ã—ã¦ä½œç”¨ã™ã‚‹

## `~`æ¼”ç®—å­
 - å¦å®šã®ã“ã¨
   - `pd.Series([True, False])` -> `[True, False]`
   - `~pd.Series([True, False])` -> `[False, True]`

## tqdm
ï¼’ã¤ã‚„ã‚Šæ–¹ãŒã‚ã‚‹
 - 1
```python
from tqdm import tqdm
tqdm.pandas()
df.progress_apply(func)
```
 - 2
```python
from tqdm import tqdm_notebook
for i in tqdm_notebook(len(df)):
  ...
```

## é‡è¤‡ã®å‰Šé™¤
```python
df.drop_duplicates(subset=["column_name"], inplace=True)
```

## è¤‡æ•°è¡Œã®jsonã®ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
```python
# BQã§ä½¿ã†ã‚ˆã†ãªè¤‡æ•°è¡Œã®jsonã§ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
df = pd.read_json("log.json.gz", compression="gzip", lines=True)
```

## paralll_apply
ã§ã‹ã„ãƒ‡ãƒ¼ã‚¿ã‚’applyã™ã‚‹ã¨ããªã©ã«ä¾¿åˆ©
```python
from pandarallel import pandarallel
pandarallel.initialize()

df.foo.parallel_apply(func)
```


## pivot
 - ç‰¹å®šã®rowã‚’columnã«ã™ã‚‹
 - `index`, `columns`, `values`ã‚’æŒ‡å®šã™ã‚‹

e.g. å…¨ä¸–ç•Œã®å¹´ã”ã¨ã®ãƒ‰ã‚¯ã‚¿ãƒ¼ã®æ•°

```python
>>> import pandas as pd
>>> df = pd.read_csv("medicalDoctors.csv")
>>> df
         Location  Period                     Indicator  First Tooltip
0     Afghanistan    2016  Medical doctors (per 10,000)           2.78
2505     Zimbabwe    1990  Medical doctors (per 10,000)           1.27

[2506 rows x 4 columns]
>>> df.pivot(index=["Location"], columns=["Period"], values=["First Tooltip"])
                                   First Tooltip                                                                      ...
Period                                      1990   1991   1992   1993   1994   1995   1996   1997   1998 1999   2000  ...  2008   2009   2010   2011   2012   2013  2014   2015   2016   2017   2018
Location                                                                                                              ...
```

## pd.get_dummmies
 - ãƒ€ãƒŸãƒ¼å¤‰æ•°ã‚’å…¥ã‚Œã‚‹
 - ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’ãƒ¯ãƒ³ãƒ›ãƒƒãƒˆãƒ™ã‚¯ãƒˆãƒ«ã«å¤‰ãˆã‚‹

```python
>>> pd.get_dummies(df, columns=["Location"]) Period                     Indicator  First Tooltip  Location_Afghanistan  ...  Location_Viet Nam  Location_Yemen  Location_Zambia  Location_Zimbabwe
0       2016  Medical doctors (per 10,000)           2.78                     1  ...                  0               0                0                  0
```

## dataframeã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä»£å…¥
```python
>>> df.Period = df.Period + 1
```

## å°–åº¦ãƒ»æ­ªåº¦ãƒ»std

```python
agg_df = df.groupby(["foo", "bar", ...]) \
			.agg(
			   mean=(target, "mean"), 
			   median=(target, "median"), 
			   skew=(target, "skew"),
			   kurtosis=(target, pd.DataFrame.kurt),
			   std=(target, "std"))
```

## ç‰¹å®šã®indexã®å€¤ã‚’update
 - e.g. ç‰¹å®šã®å€¤ãŒä¸€å®šä»¥ä¸‹ã®æ¤œç´¢ã‚’è¡Œã„indexã®å€¤ã‚’å–ã‚Šå‡ºã—ã€å€¤ã‚’3å€ã«ã™ã‚‹

```python
index = df[df["First Tooltip"] <= 100].index

df.loc[index, "Period"] = df.loc[index, "Period"] * 3
```

## dataframeã«å¯¾ã™ã‚‹apply

`apply`ã«å¯¾ã™ã‚‹`axis=1`ã‚’é©å¿œã™ã‚‹ã¨`è¡Œ`ã«å¯¾ã—ã¦é©å¿œã§ãã‚‹
```python
df.apply(something_function, axis=1)
```
